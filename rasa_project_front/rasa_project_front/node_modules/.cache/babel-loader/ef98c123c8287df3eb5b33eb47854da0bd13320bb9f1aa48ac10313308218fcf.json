{"ast":null,"code":"import axios from \"axios\";\nimport Highcharts from \"highcharts\";\nimport * as d3 from \"d3\";\nexport default {\n  name: \"Charts\",\n  methods: {\n    fetchGraphData() {\n      axios.post(\"/charts/get_graph_data\").then(response => {\n        this.drawGraph(response.data);\n      }).catch(error => {\n        console.log(\"获取知识图谱数据失败：\" + error);\n      });\n    },\n    drawGraph(graphData) {\n      const svg = d3.select(this.$refs.graphContainer);\n\n      // 清空现有的 SVG 内容\n      svg.selectAll('*').remove();\n\n      // 设置 SVG 尺寸\n      const width = 900;\n      const height = 800;\n      svg.attr('width', width).attr('height', height);\n\n      // 创建一个力导向布局\n      const simulation = d3.forceSimulation(graphData.nodes).force('charge', d3.forceManyBody()).force('center', d3.forceCenter(width / 2, height / 2));\n\n      // 创建箭头\n      svg.append('defs').selectAll('marker').data(['arrow']) // 定义箭头的名称\n      .enter().append('marker').attr('id', d => d).attr('viewBox', '0 -5 10 10').attr('refX', 20) // 控制箭头位置\n      .attr('refY', 0).attr('markerWidth', 6).attr('markerHeight', 6).attr('orient', 'auto') // 根据路径自动定向箭头\n      .append('path').attr('d', 'M0,-5L10,0L0,5').attr('class', 'arrowhead'); // 自定义箭头的样式\n\n      // 绘制边\n      const links = svg.selectAll('.link').data(graphData.edges).enter().append('line').attr('class', 'link').style('stroke', 'deepskyblue') // 设置线段颜色\n      .attr('marker-end', 'url(#arrow)'); // 引用箭头\n\n      // 在线段上标注时间\n      links.append('text').attr('class', 'time-label').attr('dy', -5) // 调整时间标签的垂直位置\n      .text(d => d.time); // 显示时间值\n\n      // 绘制节点\n      const nodes = svg.selectAll('.node').data(graphData.nodes).enter().append('g').attr('class', 'node');\n      nodes.append('circle').attr('r', 8).attr('fill', 'orange');\n\n      // 添加节点名称\n      nodes.append('text').text(d => d.name).attr('x', 12).attr('y', 4);\n\n      // 添加节点和边的交互\n      nodes.call(d3.drag().on('start', dragStarted).on('drag', dragged).on('end', dragEnded));\n\n      // 定义拖动开始、拖动过程和拖动结束的函数\n      function dragStarted(d) {\n        if (!d3.event.active) simulation.alphaTarget(0.3).restart();\n        d.fx = d.x;\n        d.fy = d.y;\n      }\n      function dragged(d) {\n        d.fx = d3.event.x;\n        d.fy = d3.event.y;\n      }\n      function dragEnded(d) {\n        if (!d3.event.active) simulation.alphaTarget(0);\n        d.fx = null;\n        d.fy = null;\n      }\n\n      // 设置边的连接\n      links.each(function (d) {\n        const sourceNode = nodes.filter(node => node.name === d.source);\n        const targetNode = nodes.filter(node => node.name === d.target);\n        if (sourceNode.size() > 0 && targetNode.size() > 0) {\n          const scaleFactor = 1;\n          // 计算线段长度，可以根据需要进行缩放\n          const length = d.time * scaleFactor; // 使用 scaleFactor 来控制长度\n          const angle = Math.atan2(targetNode.datum().y - sourceNode.datum().y, targetNode.datum().x - sourceNode.datum().x);\n          const x2 = sourceNode.datum().x + length * Math.cos(angle);\n          const y2 = sourceNode.datum().y + length * Math.sin(angle);\n          d3.select(this).attr('x1', sourceNode.datum().x).attr('y1', sourceNode.datum().y).attr('x2', x2).attr('y2', y2);\n        }\n      });\n\n      // 设置力导向布局的每一帧的动作\n      simulation.on('tick', () => {\n        links.attr('x1', d => d.source.x).attr('y1', d => d.source.y).attr('x2', d => d.target.x).attr('y2', d => d.target.y);\n        nodes.attr('transform', d => `translate(${d.x},${d.y})`);\n      });\n    }\n  },\n  mounted() {\n    this.fetchGraphData();\n  }\n};","map":{"version":3,"names":["axios","Highcharts","d3","name","methods","fetchGraphData","post","then","response","drawGraph","data","catch","error","console","log","graphData","svg","select","$refs","graphContainer","selectAll","remove","width","height","attr","simulation","forceSimulation","nodes","force","forceManyBody","forceCenter","append","enter","d","links","edges","style","text","time","call","drag","on","dragStarted","dragged","dragEnded","event","active","alphaTarget","restart","fx","x","fy","y","each","sourceNode","filter","node","source","targetNode","target","size","scaleFactor","length","angle","Math","atan2","datum","x2","cos","y2","sin","mounted"],"sources":["src/components/KnowledgeGraph.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <el-card class=\"box-card\">\r\n            <!-- SVG容器 -->\r\n      <svg ref=\"graphContainer\"></svg>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from \"axios\";\r\nimport Highcharts from \"highcharts\"\r\nimport * as d3 from \"d3\"\r\n\r\nexport default {\r\n  name: \"Charts\",\r\n  methods: {\r\n    fetchGraphData() {\r\n      axios.post(\"/charts/get_graph_data\")\r\n          .then(response => {\r\n            this.drawGraph(response.data)\r\n          })\r\n          .catch(error => {\r\n            console.log(\"获取知识图谱数据失败：\" + error)\r\n          })\r\n      },\r\n    drawGraph(graphData) {\r\n      const svg = d3.select(this.$refs.graphContainer);\r\n\r\n      // 清空现有的 SVG 内容\r\n      svg.selectAll('*').remove();\r\n\r\n      // 设置 SVG 尺寸\r\n      const width = 900;\r\n      const height = 800;\r\n      svg.attr('width', width).attr('height', height);\r\n\r\n      // 创建一个力导向布局\r\n      const simulation = d3.forceSimulation(graphData.nodes)\r\n        .force('charge', d3.forceManyBody())\r\n        .force('center', d3.forceCenter(width / 2, height / 2));\r\n\r\n      // 创建箭头\r\n      svg.append('defs').selectAll('marker')\r\n        .data(['arrow']) // 定义箭头的名称\r\n        .enter().append('marker')\r\n        .attr('id', d => d)\r\n        .attr('viewBox', '0 -5 10 10')\r\n        .attr('refX', 20) // 控制箭头位置\r\n        .attr('refY', 0)\r\n        .attr('markerWidth', 6)\r\n        .attr('markerHeight', 6)\r\n        .attr('orient', 'auto') // 根据路径自动定向箭头\r\n        .append('path')\r\n        .attr('d', 'M0,-5L10,0L0,5')\r\n        .attr('class', 'arrowhead'); // 自定义箭头的样式\r\n\r\n      // 绘制边\r\n      const links = svg.selectAll('.link')\r\n        .data(graphData.edges)\r\n        .enter().append('line')\r\n        .attr('class', 'link')\r\n        .style('stroke', 'deepskyblue') // 设置线段颜色\r\n        .attr('marker-end', 'url(#arrow)'); // 引用箭头\r\n\r\n      // 在线段上标注时间\r\n      links.append('text')\r\n        .attr('class', 'time-label')\r\n        .attr('dy', -5) // 调整时间标签的垂直位置\r\n        .text(d => d.time); // 显示时间值\r\n\r\n      // 绘制节点\r\n      const nodes = svg.selectAll('.node')\r\n        .data(graphData.nodes)\r\n        .enter().append('g')\r\n        .attr('class', 'node');\r\n\r\n      nodes.append('circle')\r\n        .attr('r', 8)\r\n        .attr('fill', 'orange');\r\n\r\n      // 添加节点名称\r\n      nodes.append('text')\r\n        .text(d => d.name)\r\n        .attr('x', 12)\r\n        .attr('y', 4);\r\n\r\n      // 添加节点和边的交互\r\n      nodes.call(d3.drag()\r\n        .on('start', dragStarted)\r\n        .on('drag', dragged)\r\n        .on('end', dragEnded)\r\n      );\r\n\r\n      // 定义拖动开始、拖动过程和拖动结束的函数\r\n      function dragStarted(d) {\r\n        if (!d3.event.active) simulation.alphaTarget(0.3).restart();\r\n        d.fx = d.x;\r\n        d.fy = d.y;\r\n      }\r\n\r\n      function dragged(d) {\r\n        d.fx = d3.event.x;\r\n        d.fy = d3.event.y;\r\n      }\r\n\r\n      function dragEnded(d) {\r\n        if (!d3.event.active) simulation.alphaTarget(0);\r\n        d.fx = null;\r\n        d.fy = null;\r\n      }\r\n\r\n      // 设置边的连接\r\n      links.each(function (d) {\r\n        const sourceNode = nodes.filter(node => node.name === d.source);\r\n        const targetNode = nodes.filter(node => node.name === d.target);\r\n        if (sourceNode.size() > 0 && targetNode.size() > 0) {\r\n          const scaleFactor = 1;\r\n          // 计算线段长度，可以根据需要进行缩放\r\n          const length = d.time * scaleFactor; // 使用 scaleFactor 来控制长度\r\n          const angle = Math.atan2(targetNode.datum().y - sourceNode.datum().y, targetNode.datum().x - sourceNode.datum().x);\r\n          const x2 = sourceNode.datum().x + length * Math.cos(angle);\r\n          const y2 = sourceNode.datum().y + length * Math.sin(angle);\r\n          d3.select(this)\r\n            .attr('x1', sourceNode.datum().x)\r\n            .attr('y1', sourceNode.datum().y)\r\n            .attr('x2', x2)\r\n            .attr('y2', y2);\r\n        }\r\n      });\r\n\r\n      // 设置力导向布局的每一帧的动作\r\n      simulation.on('tick', () => {\r\n        links\r\n          .attr('x1', d => d.source.x)\r\n          .attr('y1', d => d.source.y)\r\n          .attr('x2', d => d.target.x)\r\n          .attr('y2', d => d.target.y);\r\n\r\n        nodes\r\n          .attr('transform', d => `translate(${d.x},${d.y})`);\r\n      });\r\n    },\r\n  },\r\n  mounted() {\r\n    this.fetchGraphData()\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n  div{\r\n    height:80vh;\r\n    .box-card{\r\n      width:100%;\r\n      height: 100%;\r\n      overflow: auto;\r\n    }\r\n\r\n    .link {\r\n      stroke: deepskyblue; /* 线段颜色 */\r\n      stroke-width: 2px; /* 线段宽度 */\r\n    }\r\n\r\n    .arrowhead {\r\n      fill: black; /* 箭头颜色 */\r\n    }\r\n\r\n\r\n    .node text {\r\n      font-size: 12px; /* 节点名称文本大小 */\r\n    }\r\n  }\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}